{% extends "layouts/player.html" %}

{% block title %}{{ player_code }} | Detailed Stats | Slippi Stats{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/player_detailed.css') }}">
{% endblock %}

{% block content %}
<div class="row">
    <!-- Sidebar with Filters -->
    <div class="col-lg-3 sidebar">
        <div class="filter-section">
            <div class="filter-header">
                <i class="bi bi-funnel-fill me-2"></i>Filters
            </div>
            
            <!-- Your Character Filter -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">Your Character</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="characterFilterToggle" checked>
                        <label class="form-check-label" for="characterFilterToggle">Use Checkboxes</label>
                    </div>
                </div>
                <select class="form-select" id="characterFilter">
                    <option value="all" selected>All Characters</option>
                    <!-- Will be populated by JavaScript -->
                </select>
                <div class="filter-checkboxes" id="characterCheckboxes" style="display: none;">
                    <div class="checkbox-item select-all-option">
                        <div class="form-check">
                            <input class="form-check-input select-all" type="checkbox" id="selectAllCharacters" checked>
                            <label class="form-check-label" for="selectAllCharacters">All Characters</label>
                        </div>
                    </div>
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Opponent Filter -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">Opponent</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="opponentFilterToggle" checked>
                        <label class="form-check-label" for="opponentFilterToggle">Use Checkboxes</label>
                    </div>
                </div>
                <select class="form-select" id="opponentFilter">
                    <option value="all" selected>All Opponents</option>
                    <!-- Will be populated by JavaScript -->
                </select>
                <div class="filter-checkboxes" id="opponentCheckboxes" style="display: none;">
                    <div class="checkbox-item select-all-option">
                        <div class="form-check">
                            <input class="form-check-input select-all" type="checkbox" id="selectAllOpponents" checked>
                            <label class="form-check-label" for="selectAllOpponents">All Opponents</label>
                        </div>
                    </div>
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Opponent's Character Filter -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">Opponent's Character</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="opponentCharFilterToggle" checked>
                        <label class="form-check-label" for="opponentCharFilterToggle">Use Checkboxes</label>
                    </div>
                </div>
                <select class="form-select" id="opponentCharacterFilter">
                    <option value="all" selected>All Characters</option>
                    <!-- Will be populated by JavaScript -->
                </select>
                <div class="filter-checkboxes" id="opponentCharCheckboxes" style="display: none;">
                    <div class="checkbox-item select-all-option">
                        <div class="form-check">
                            <input class="form-check-input select-all" type="checkbox" id="selectAllOpponentChars" checked>
                            <label class="form-check-label" for="selectAllOpponentChars">All Characters</label>
                        </div>
                    </div>
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Filter Buttons -->
            <div class="d-grid gap-2">
                <button id="applyFilters" class="btn btn-primary">Apply Filters</button>
                <button id="resetFilters" class="btn btn-outline-secondary">Reset Filters</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="col-lg-9 offset-lg-3 main-content-detailed">
        <div class="px-3">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="player-header">
                        <h1 class="display-4">{{ player_code }} <small class="text-muted fs-5">Detailed Statistics</small></h1>
                        <p class="lead">Analyze your performance with advanced filtering</p>
                    </div>
                </div>
            </div>        
            
            <!-- Top Summary Row -->
            <div class="row mb-4">
                <div class="col-md-5">
                    <div class="card stat-card h-100">
                        <div class="card-body text-center">
                            <h5 class="card-title">Overall Performance</h5>
                            <div class="win-rate-circle my-3" id="overall-win-rate-circle" style="--win-rate: 0">
                                <div class="win-rate-inner" id="overall-win-rate">0%</div>
                            </div>
                            <p class="card-text" id="overall-stats">
                                <strong>0</strong> wins out of <strong>0</strong> games
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-7">
                    <div class="card stat-card h-100">
                        <div class="card-header">
                            <h5>Filters Applied</h5>
                        </div>
                        <div class="card-body">
                            <p id="charactersPlayingAs" class="mb-2">Playing as: <strong>All characters</strong></p>
                            <p id="opponentsPlayingAgainst" class="mb-2">Playing against: <strong>All opponents</strong></p>
                            <p id="charactersPlayingAgainst" class="mb-2">Opposing characters: <strong>All characters</strong></p>
                            <p class="text-muted small">Showing data from <span id="totalGamesCount">0</span> matches</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stats Tables Row -->
            <div class="row table-section">
                <!-- Character Stats -->
                <div class="col-md-4 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Character Stats</h5>
                            <span class="badge rounded-pill bg-primary" id="character-count">0</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="scrollable-table">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Character</th>
                                            <th>Games</th>
                                            <th>Win %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="character-stats-table">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Opponent Stats -->
                <div class="col-md-4 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Opponent Stats</h5>
                            <span class="badge rounded-pill bg-primary" id="opponent-count">0</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="scrollable-table">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Opponent</th>
                                            <th>Games</th>
                                            <th>Win %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="opponent-stats-table">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Opponent Character Stats -->
                <div class="col-md-4 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Matchup Stats</h5>
                            <span class="badge rounded-pill bg-primary" id="matchup-count">0</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="scrollable-table">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Character</th>
                                            <th>Games</th>
                                            <th>Win %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="matchup-stats-table">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Time Chart -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card stat-card">
                        <div class="card-header">
                            <h5>Win Rate Over Time</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="position: relative; height:300px;">
                                <canvas id="timeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Character Chart -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card stat-card">
                        <div class="card-header">
                            <h5>Character Performance</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="position: relative; height:300px;">
                                <canvas id="characterChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="spinner-border loading-spinner" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pages/player_detailed.js') }}"></script>
{% endblock %}