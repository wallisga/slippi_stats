{% extends "base.html" %}

{# Import component macros - this makes them available to pages that extend this layout #}
{% from 'components/search/_search.html' import navbar_search %}
{% from 'components/cards/_cards.html' import stat_card, performance_overview_card, highlights_card, win_rate_circle_card, filter_summary_card, loading_overlay %}
{% from 'components/tables/_tables.html' import recent_games_table, stats_table, detailed_stats_table %}
{% from 'components/filters/_filters.html' import advanced_filters_card, filter_column %}
{% from 'components/charts/_charts.html' import chart_card %}
{% from 'components/player_dropdown/_player_dropdown.html' import player_dropdown %}

{# Include components for asset loading #}
{% include 'components/search/_search.html' %}
{% include 'components/character_icons/_character_icons.html' %}
{% include 'components/cards/_cards.html' %}
{% include 'components/tables/_tables.html' %}
{% include 'components/filters/_filters.html' %}
{% include 'components/charts/_charts.html' %}
{% include 'components/player_title/_player_title.html' %}
{% include 'components/player_dropdown/_player_dropdown.html' %}

{% block layout_css %}
{# Component CSS is loaded by the included components above #}
{% endblock %}

{% block nav_items %}
{{ player_dropdown(player_code if player_code is defined else None) }}
<li class="nav-item">
    <a class="nav-link {% if '/download' in request.path %}active{% endif %}" href="/download">Download</a>
</li>
{% endblock %}

{% block nav_extras %}
{{ navbar_search(true, "Find Player...") }}
{% endblock %}

{% block content_wrapper %}
<div class="container mt-4">
    <!-- Player Title Component Container -->
    <div id="player-title-container">
        <!-- Title will be generated by JavaScript component -->
    </div>
    
    <!-- Player data as JSON scripts (avoids HTML attribute length limits) -->
    <script type="application/json" id="player-data">
    {
        "playerCode": {{ (player_code | tojson) if player_code is defined else '""' }},
        "stats": {{ (stats | tojson) if stats is defined else '{}' }},
        "recentGames": {{ (recent_games | tojson) if recent_games is defined else '[]' }}
    }
    </script>
    
    {% block content %}{% endblock %}
</div>
{% endblock %}

{% block layout_js %}
{# Component JS is loaded by the included components above #}
{# Additional chart.js for stats visualization #}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}